%%{init: {'theme': 'default', 'themeVariables': {'background': '#ffffff'}}}%%
sequenceDiagram
    participant Client
    participant Routes
    participant Workflows
    participant Services
    participant Evolution
    participant Regressor

    Client->>Routes: POST /simulator/run
    Routes->>Workflows: __call__(request)

    loop For each cluster/device
        Workflows->>Services: run_simulation()
        Services->>Evolution: evolve()

        loop GA Generations
            Evolution->>Evolution: Generate population
            Evolution->>Regressor: predict(features)
            Regressor-->>Evolution: TTFT, throughput, latency
            Evolution->>Evolution: Calculate fitness
            Evolution->>Evolution: Select & crossover
        end

        Evolution-->>Services: Top-k configs
        Services->>Services: Save to database
    end

    Workflows-->>Routes: ClusterRecommendationResponse
    Routes-->>Client: 200 OK + recommendations
