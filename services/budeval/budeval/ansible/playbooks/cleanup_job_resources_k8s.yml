---
- name: Cleanup Kubernetes Job Resources
  hosts: localhost
  connection: local
  gather_facts: no
  collections:
    - kubernetes.core

  tasks:
    - name: Delete evaluation job
      kubernetes.core.k8s:
        state: absent
        api_version: batch/v1
        kind: Job
        name: "{{ job_name }}"
        namespace: "{{ namespace }}"
        kubeconfig: "{{ kubeconfig_path | default(omit) }}"
      ignore_errors: yes

    - name: Delete ConfigMap
      kubernetes.core.k8s:
        state: absent
        api_version: v1
        kind: ConfigMap
        name: "opencompass-config-{{ job_name.split('-')[1] if '-' in job_name else job_name }}"
        namespace: "{{ namespace }}"
        kubeconfig: "{{ kubeconfig_path | default(omit) }}"
      ignore_errors: yes

    - name: Display cleanup completion
      debug:
        msg: "Cleanup completed for job {{ job_name }}"
