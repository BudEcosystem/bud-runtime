---
- name: Verify Kubernetes cluster connectivity
  hosts: localhost
  connection: local
  gather_facts: no
  collections:
    - community.kubernetes

  tasks:
    - name: List Kubernetes namespaces to verify connectivity
      community.kubernetes.k8s_info:
        kind: Namespace
        kubeconfig: "{{ kubeconfig_path | default(omit) }}"
      register: ns

    - name: Assert that namespaces were listed successfully
      assert:
        that:
          - ns.resources is defined
        fail_msg: "Failed to connect to Kubernetes cluster: unable to list namespaces"
