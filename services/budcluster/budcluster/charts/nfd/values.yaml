# Node Feature Discovery Configuration
# This values file configures NFD for bud-stack hardware detection

# Global settings
global:
  namespace: node-feature-discovery

# NFD configuration - controls whether to deploy NFD as dependency
nfd:
  enabled: true

# Configuration for NFD dependency (node-feature-discovery chart)
node-feature-discovery:
  master:
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 200m
        memory: 256Mi

  worker:
    resources:
      requests:
        cpu: 100m
        memory: 64Mi
      limits:
        cpu: 200m
        memory: 128Mi
    securityContext:
      privileged: true
      allowPrivilegeEscalation: true
    extraArgs:
      - "-v=5"

    config:
      core:
        sleepInterval: 60s
        # Allow NFD labels and custom labels for hardware detection
        # labelWhiteList: "^(feature\\.node\\.kubernetes\\.io/.*|cpu-.*|intel\\.com/.*|nvidia\\.com/.*)$"
        labelSources:
          - custom
          - pci
          - cpu
          - kernel
          - local
          - memory
          - network
          - storage
          - system
          - usb

      sources:
        cpu:
          cpuid:
            # Include all CPUID attributes for full detection
            attributeBlacklist: []
            attributeWhitelist: []

        # System detection for OS and node info
        system:
          osRelease:
            id:
              - "ID"
              - "VERSION_ID"
          name:
            - "nodename"

        # Local hooks for custom CPU detection
        local:
          hooksEnabled: true

        # Simplified custom rules - let default sources handle most labeling
        custom: []

        pci:
          deviceClassWhitelist:
            - "^.*$"
          deviceLabelFields:
            - vendor          # Essential - identifies manufacturer
            - device          # Essential - identifies specific model
            - class           # Essential - identifies device type
            - subsystem_vendor # Useful - card manufacturer (ASUS, MSI, etc.)
            - subsystem_device # Useful - specific card variant

  topologyUpdater:
    enable: true
    createCRDs: true

# GPU Operator configuration (deployed conditionally)
gpuOperator:
  enabled: false

# Intel Device Plugin configuration (deployed conditionally)
intelDevicePlugin:
  enabled: false
  gaudiEnabled: true
