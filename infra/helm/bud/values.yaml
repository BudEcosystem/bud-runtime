# TODO: migrate from bitnami (oss rugpull)
global:
  security:
    allowInsecureImages: true
  # Optional node scheduling configuration applied to all microservices by default
  # Can be overridden per-service in microservices.<service>.nodeSelector and microservices.<service>.affinity
  nodeSelector: {}
  # Example:
  # nodeSelector:
  #   environment: production
  #   tier: backend
  affinity: {}
  # Example:
  # affinity:
  #   nodeAffinity:
  #     requiredDuringSchedulingIgnoredDuringExecution:
  #       nodeSelectorTerms:
  #       - matchExpressions:
  #         - key: kubernetes.io/arch
  #           operator: In
  #           values:
  #           - amd64
imagePullSecrets: []
# NOTE: support for https://keel.sh/
imagePullPolicy: "IfNotPresent"

# Dapr APP_API_TOKEN for securing internal service-to-service endpoints
# Leave empty to auto-generate a random token, or set explicitly for consistency across deployments
appApiToken: ""
deploymentAnnotations: {}
storage:
  budmodelRegistry:
    className: ""
    size: 32Gi
  budmodelAddDir:
    className: ""
    size: 20Gi
  budevalDataset:
    className: ""
    size: 32Gi
  budappStaticDir:
    className: ""
    size: 20Gi
externalServices:
  minio:
    endpoint: ""
    auth:
      secretKey: ""
      accessKey: ""
    buckets:
      modelRegistry: "models-registry"
      modelInfo: "model-info"
  postgresql:
    host: ""
    port: "5432"
    databases:
      keycloak:
        name: "keycloak"
        username: "keycloak"
        password: "keycloak"
      budask:
        name: "budask"
        username: "budask"
        password: "budask"
      budapp:
        name: "budapp"
        username: "budapp"
        password: "budapp"
      budcluster:
        name: "budcluster"
        username: "budcluster"
        password: "budcluster"
      budmetrics:
        name: "budmetrics"
        username: "budmetrics"
        password: "budmetrics"
      budmodel:
        name: "budmodel"
        username: "budmodel"
        password: "budmodel"
      budsim:
        name: "budsim"
        username: "budsim"
        password: "budsim"
      budeval:
        name: "budeval"
        username: "budeval"
        password: "budeval"
      buddoc:
        name: "buddoc"
        username: "buddoc"
        password: "buddoc"
      budprompt:
        name: "budprompt"
        username: "budprompt"
        password: "budprompt"
      mcpgateway:
        name: "mcpgateway"
        username: "mcpgateway"
        password: "mcpgateway"
      budpipeline:
        name: "budpipeline"
        username: "budpipeline"
        password: "budpipeline"
      onyx:
        name: "onyx"
        username: "onyx"
        password: "onyx"
        # TODO: map all external service through here
        # monogodb:
        #   endpoint: ""
        #   database:
        #   auth:
        #     username:
        #     password:
        # keycloak:
        #   endpoint: ""
        # valkey:
        #   endpoint: ""
        # clickhouse:
        #   endpoint: ""
        # kafka:
        #   endpoint: ""
ingress:
  enabled: true
  # NOTE: used to derive public urls for client side services: (external|internal|disabled)
  https: disabled
  hosts:
    root: "bud.example.com"
    # NOTE: rest is derived from root by ./templates/_helpers.tpl
    budadmin: ""
    budcustomer: ""
    budplayground: ""
    budapp: ""
    budgateway: ""
    budask: ""
    novuapi: ""
    novuws: ""
    s3: ""
    mcpgateway: ""
    onyx: ""  # Auto-derives to chat.{root} e.g., chat.dev.domain.com
microservices:
  # frontend services
  budadmin:
    enabled: true
    image: budstudio/budadmin:0.5.0
    # Branding configuration - customize logos per customer deployment
    # Leave empty to use default Bud logos
    env:
    # Main logo for dashboard sidebar and header
    # NEXT_PUBLIC_LOGO_URL: "/images/customer-logo.svg"
    # Logo for auth pages (login/register)
    # NEXT_PUBLIC_LOGO_AUTH_URL: "/images/customer-logo-auth.png"
    # Favicon for browser tab
    # NEXT_PUBLIC_FAVICON_URL: "/favicon-customer.ico"
    # Optional per-service node scheduling (overrides global)
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  budcustomer:
    enabled: true
    image: budstudio/budcustomer:0.5.0
    env: {}
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  budplayground:
    enabled: true
    image: budstudio/budplayground:0.5.0
    env: {}
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  # backend exposed services
  budgateway:
    enabled: true
    image: budstudio/budgateway:0.5.0
    env:
      OTEL_EXPORTER_OTLP_TRACES_ENDPOINT: "http://{{ $.Release.Name }}-otel-collector:4317"
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration for budgateway
    autoscaling:
      enabled: true
      minReplicas: 1
      maxReplicas: 10
      # CPU-based scaling (optional)
      targetCPUUtilizationPercentage: 70
      # Memory-based scaling (optional)
      targetMemoryUtilizationPercentage: 80
      # Prometheus custom metrics scaling (requires prometheus-adapter)
      prometheusMetrics:
        enabled: true
        # Gateway processing overhead metric - p95 percentile (excludes model inference time)
        # Exposed by prometheus-adapter from gateway_processing_seconds histogram
        metricName: gateway_processing_seconds_p95
        # Target average p95 processing time per pod (2ms = 2m)
        targetValue: "2m"
      # Scale down stabilization (avoid flapping)
      scaleDownStabilizationSeconds: 300
      # Scale up stabilization (react quickly to load)
      scaleUpStabilizationSeconds: 0
  budsentinel:
    enabled: false # closed source, avoid enabling by default
    image: harbor.bud.studio/sentinel/sentinel:nightly
    env: {}
    nodeSelector: {}
    affinity: {}
  mcpgateway:
    enabled: true
    image: budstudio/mcpgateway:latest
    env: {}
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  askbud:
    enabled: true
    image: budstudio/askbud:0.5.0
    daprid: askbud
    model: bud-gpt-oss-20b-ada28b58
    env:
      INFERENCE_API_KEY: "test"
      INFERENCE_URL: http://52.241.253.58/v1/
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  budapp:
    enabled: true
    image: budstudio/budapp:0.5.0
    daprid: budapp
    corsOrigins:
      - "http://localhost:3000"
      - "http://localhost:3001"
    env:
      GRAFANA_SCHEME: http
      GRAFANA_URL: "{{ $.Release.Name }}-grafana"
      KEYCLOAK_SERVER_URL: http://{{ $.Release.Name }}-keycloak/
      KEYCLOAK_REALM_NAME: "{{ .Values.keycloak.adminRealm }}"
      KEYCLOAK_ADMIN_USERNAME: "{{ .Values.keycloak.auth.adminUser }}"
      KEYCLOAK_ADMIN_PASSWORD: "{{ .Values.keycloak.auth.adminPassword }}"
      KEYCLOAK_VERIFY_SSL: "false"
      DEFAULT_REALM_NAME: bud-keycloak
      CLOUD_MODEL_SEEDER_ENGINE: tensorzero
      BUD_CONNECT_BASE_URL: https://budconnect.bud.studio
      BUD_DOC_SERVICE_URL: "http://{{ $.Release.Name }}-buddoc:9081"
      BUD_PROMPT_SERVICE_URL: "http://{{ $.Release.Name }}-budprompt:3015/v1/"
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  # backend internal services
  budcluster:
    enabled: true
    image: budstudio/budcluster:0.5.0
    daprid: budcluster
    env:
      LOG_LEVEL: INFO
      RSA_KEY_NAME: rsa-private-key.pem
      VOLUME_TYPE: local
      CONFIGSTORE_NAME: "{{ .Release.Name }}-configstore"
      SECRETSTORE_SECRET_NAME: "{{ .Release.Name }}-secretstore"
      STATESTORE_NAME: "{{ .Release.Name }}-dapr-statestore"
      VALIDATE_CERTS: "false"
      NODE_INFO_COLLECTOR_IMAGE_CPU: budstudio/node-info-collector-cpu:0.1.0
      NODE_INFO_COLLECTOR_IMAGE_CUDA: budimages.azurecr.io/budecosystem/node-info-collector-cuda:latest
      NODE_INFO_COLLECTOR_IMAGE_HPU: budimages.azurecr.io/budecosystem/node-info-collector-hpu:latest
      NODE_INFO_LABELER_IMAGE: budimages.azurecr.io/budecosystem/node-device-labeler:latest
      QUANTIZATION_JOB_IMAGE: budimages.azurecr.io/budecosystem/bud-quantization-cpu:0.02
      ENGINE_CONTAINER_PORT: "8000"
      REGISTRY_SERVER: https://budimages.azurecr.io
      # Metrics collection configuration
      METRICS_COLLECTION_ENABLED: "true"
      METRICS_COLLECTION_TIMEOUT: "30"
      METRICS_BATCH_SIZE: "20000"
      # OpenTelemetry Collector configuration
      OTEL_COLLECTOR_ENDPOINT: "http://{{ $.Release.Name }}-otel-collector:4318"
      # Prometheus configuration
      PROMETHEUS_SERVICE_NAME: "bud-metrics-kube-prometheu-prometheus"
      PROMETHEUS_NAMESPACE: "bud-system"
      PROMETHEUS_PORT: "9090"
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (longer stabilization for workflows)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 80
      targetMemoryUtilizationPercentage: 70
      scaleDownStabilizationSeconds: 600
      scaleUpStabilizationSeconds: 60
  budmetrics:
    enabled: true
    daprid: budmetrics
    image: budstudio/budmetrics:0.5.0
    env:
      #deadlink
      INFERENCE_URL: http://172.184.137.177:8502/classify
      CLICKHOUSE_HOST: "{{ .Release.Name }}-clickhouse"
      CLICKHOUSE_PORT: "9000"
      CLICKHOUSE_DB_NAME: budproxy
      SECRETS_CLICKHOUSE_USER: "{{ .Values.clickhouse.auth.username }}"
      SECRETS_CLICKHOUSE_PASSWORD: "{{ .Values.clickhouse.auth.password }}"
      # ClickHouse TTL configuration for cluster metrics (in days)
      CLICKHOUSE_TTL_CLUSTER_METRICS: "30"
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  budmodel:
    enabled: true
    image: budstudio/budmodel:0.5.0
    daprid: budmodel
    storageClassName: nfs-csi
    storageSize: "32Gi"
    env:
      LOG_LEVEL: INFO
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (lower CPU due to I/O-bound workload)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 60
      targetMemoryUtilizationPercentage: 70
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 60
  budeval:
    enabled: true
    image: budstudio/budeval:0.5.0
    daprid: budeval
    storageClassName: nfs-csi
    env: {}
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (longer stabilization for evaluation workflows)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 75
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 600
      scaleUpStabilizationSeconds: 60
  budsim:
    enabled: true
    image: budstudio/budsim:0.5.0
    daprid: budsim
    env:
      LOG_LEVEL: INFO
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (longer stabilization for ML optimization workflows)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 75
      targetMemoryUtilizationPercentage: 80
      scaleDownStabilizationSeconds: 600
      scaleUpStabilizationSeconds: 60
  buddoc:
    enabled: true
    image: budstudio/buddoc:0.5.0
    daprid: buddoc
    env:
      LOG_LEVEL: INFO
      VLM_API_URL: "http://{{ $.Release.Name }}-budgateway:3000/v1/chat/completions"
      VLM_API_TIMEOUT: "300"
      MAX_FILE_SIZE_MB: "50"
      TEMP_UPLOAD_DIR: /tmp/buddoc_uploads
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (lower CPU due to document processing)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 2
      targetCPUUtilizationPercentage: 60
      targetMemoryUtilizationPercentage: 70
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 60
  budnotify:
    enabled: true
    image: budstudio/budnotify:0.5.0
    daprid: budnotify
    pubsubTopic: notificationMessages
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration (fast scale-up for notifications)
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 3
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 0
  budprompt:
    enabled: true
    daprid: budprompt
    image: budstudio/budprompt:0.5.0
    env:
      LOG_LEVEL: INFO
      BUD_GATEWAY_BASE_URL: http://{{ .Release.Name }}-budgateway:3000/v1
      REDIS_HOST: "{{ .Release.Name }}-valkey-primary"
      REDIS_PORT: "6379"
      REDIS_DB_INDEX: "10"
      REDIS_PASSWORD: "{{ .Values.valkey.auth.password }}"
      OTEL_SDK_DISABLED: "false"
      OTEL_EXPORTER_OTLP_ENDPOINT: "http://{{ $.Release.Name }}-otel-collector:4318"
    nodeSelector: {}
    affinity: {}
    # Autoscaling configuration
    autoscaling:
      enabled: false
      minReplicas: 1
      maxReplicas: 5
      targetCPUUtilizationPercentage: 70
      targetMemoryUtilizationPercentage: 75
      scaleDownStabilizationSeconds: 300
      scaleUpStabilizationSeconds: 30
  budpipeline:
    enabled: true
    image: budstudio/budpipeline:0.4.8
    daprid: budpipeline
    pubsubTopic: budpipelineEvents
    env:
      LOG_LEVEL: INFO
    nodeSelector: {}
    affinity: {}
  global:
    env:
      PROMETHEUS_URL: https://metric.bud.studio
      # deadlink
      BUD_LLM_BASE_URL: http://52.241.253.58/v1/
      #deadlink
      EVAL_MANIFEST_URL: https://eval-datasets.bud.eco/v2/manifest.json
      #deadlink
      S3_LOCAL_STACK: http://localhost:4566
      DAPR_BASE_URL: http://localhost:3500
      DAPR_HOST_IP: 127.0.0.1
      WIDGET_EMBED_PATH: http://{{ .Release.Name }}-embed:4701/embed.umd.min.js
      MONGO_URL: mongodb://{{ index .Values.mongodb.auth.usernames 0 }}:{{ index .Values.mongodb.auth.passwords 0 }}@{{ .Release.Name }}-mongodb:27017/{{ index .Values.mongodb.auth.databases 0 }}
      REACT_APP_WS_URL: http://{{ .Release.Name }}-ws:3000
      FRONT_BASE_URL: http://{{ .Release.Name }}-web:4200
      HOST_NAME: http://{{ .Release.Name }}-web:4200
      WIDGET_URL: http://{{ .Release.Name }}-web:4200
      API_BASE_URL: http://{{ .Release.Name }}-api:3000
      API_ROOT_URL: http://{{ .Release.Name }}-api:3000
      NOVU_API_BASE_URL: http://{{ .Release.Name }}-api:3000
      ADD_MODEL_DIR: /datadisk/add_model_dir
      API_CONTEXT_PATH: ""
      APP_CONFIG: "{}"
      APP_NAME: budapp
      APP_PORT_BUDAPP: "9082"
      APP_PORT_BUDPROXY: "3000"
      AWS_ACCESS_KEY_ID: test
      AWS_SECRET_ACCESS_KEY: test
      BUD_CONNECT_URL: https://budconnect.bud.studio
      BUD_LLM_MODEL: bud-gpt-oss-20b-ada28b58
      CI: "true"
      CLICKHOUSE_USER: "{{ .Values.clickhouse.auth.username }}"
      CLICKHOUSE_PASSWORD: "{{ .Values.clickhouse.auth.password }}"
      CONFIGSTORE_NAME: "{{ .Release.Name }}-configstore"
      DISABLE_USER_REGISTRATION: "false"
      DOCKER_REDIS_SERVICE_PORT: "6379"
      ENGINE_CONTAINER_PORT: "8000"
      EVAL_SYNC_ENABLED: "true"
      EVAL_SYNC_LOCAL_MODE: "true"
      EVAL_SYNC_USE_BUNDLES: "false"
      GENERATION_COUNT: "10"
      GLOBAL_CONTEXT_PATH: ""
      IS_MULTI_TENANCY_ENABLED: "true"
      IS_TOPIC_NOTIFICATION_ENABLED: "true"
      LOG_LEVEL: INFO
      MINIO_ACCESS_KEY: "{{ .Values.minio.auth.rootUser }}"
      MINIO_BUCKET: models-registry
      MINIO_ENDPOINT: '{{ include "bud.ingress.hosts.s3" $ }}'
      MINIO_MODEL_BUCKET: model-info
      MINIO_SECRET_KEY: "{{ .Values.minio.auth.rootPassword }}"
      MINIO_SECURE: "{{ .Values.ingress.httpsEnabled }}"
      MODEL_DOWNLOAD_DIR: /data/models-registry
      MODEL_DOWNLOAD_DIR_MAX_SIZE: "500"
      MODEL_REGISTRY_DIR: /data/models-registry
      MONGO_MAX_POOL_SIZE: "200"
      MONGO_MIN_POOL_SIZE: "100"
      NEW_RELIC_APP_NAME: budnotify
      NEW_RELIC_NO_CONFIG_FILE: "true"
      NODE_ENV: production
      NODE_INFO_COLLECTOR_IMAGE_CPU: budstudio/node-info-collector-cpu:0.1.0
      NODE_INFO_COLLECTOR_IMAGE_CUDA: budimages.azurecr.io/budecosystem/node-info-collector-cuda:latest
      NODE_INFO_COLLECTOR_IMAGE_HPU: budimages.azurecr.io/budecosystem/node-info-collector-hpu:latest
      NODE_INFO_LABELER_IMAGE: budimages.azurecr.io/budecosystem/node-device-labeler:latest
      NODE_VERSION: 20.11.1
      NOTIFY_SERVICE_NAME: "{{ .Values.microservices.budnotify.daprid }}"
      NOTIFY_SERVICE_TOPIC: "{{ .Values.microservices.budnotify.pubsubTopic }}"
      NX_DAEMON: "false"
      PGADMIN_DEFAULT_EMAIL: user@bud.studio
      PGADMIN_DEFAULT_PASSWORD: budpassword
      PGADMIN_PORT: "8888"
      POPULATION_SIZE: "50"
      PORT: "3000"
      REDIS_CACHE_SERVICE_HOST: ""
      REDIS_CACHE_SERVICE_PORT: "6379"
      REDIS_DB_INDEX: "5"
      REDIS_HOST: "{{ .Release.Name }}-valkey-primary"
      REDIS_PASSWORD: "{{ .Values.valkey.auth.password }}"
      REDIS_PASSWORD_BUDAPP: "{{ .Values.valkey.auth.password }}"
      REDIS_PORT: "6379"
      REDIS_URI: "{{ .Release.Name }}-valkey-primary:6379"
      REGISTRY_SERVER: https://budimages.azurecr.io
      S3_BUCKET_NAME: novu-local
      S3_REGION: us-east-1
      # TODO
      SECRETSTORE_NAME: "{{ .Release.Name}}-secretstore"
      SECRETSTORE_SECRET_NAME: "{{ .Release.Name }}-secretstore"
      # TODO
      SENTRY_DSN: ""
      TENSORZERO_REDIS_URL: redis://default:{{ .Values.valkey.auth.password}}@{{ .Release.Name }}-valkey-primary:6379/2
      VALIDATE_CERTS: "false"
      VLLM_CPU_IMAGE: budimages.azurecr.io/budecosystem/bud-runtime-cpu:0.11
      VLLM_CUDA_IMAGE: budimages.azurecr.io/budecosystem/bud-runtime-cuda:0.02
      VLLM_HPU_IMAGE: budimages.azurecr.io/budecosystem/bud-runtime-hpu:latest
      WEB_CONTEXT_PATH: ""
      WS_CONTEXT_PATH: ""
      WS_PORT: "3000"
      YARN_VERSION: 1.22.19
      RSA_KEY_NAME: rsa-private-key.pem
valkey:
  image:
    repository: bitnamilegacy/valkey
  enabled: true
  architecture: standalone
  commonConfiguration: |-
    notify-keyspace-events KEA

    # default values from chart
    appendonly yes
    save ""
  auth:
    password: bud
  primary:
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 1000m
  # Optional node scheduling for Valkey (Redis)
  master:
    nodeSelector: {}
    affinity: {}
    # Resource limits to prevent OOM and pod restarts
    resources:
      requests:
        memory: 512Mi
        cpu: 250m
      limits:
        memory: 1Gi
        cpu: 1000m
    # Improved liveness probe to handle AOF loading and memory pressure
    livenessProbe:
      enabled: true
      initialDelaySeconds: 30
      periodSeconds: 10
      timeoutSeconds: 10
      failureThreshold: 10
      successThreshold: 1
  replica:
    nodeSelector: {}
    affinity: {}
clickhouse:
  enabled: true
  image:
    repository: bitnamilegacy/clickhouse
  replicaCount: 1
  shards: 1
  auth:
    username: bud
    password: bud
  resources:
    requests:
      memory: 4Gi
      cpu: 1000m
    limits:
      memory: 8Gi
      cpu: 4000m
  keeper:
    replicaCount: 1
    image:
      repository: bitnamilegacy/clickhouse-keeper
  # Optional node scheduling for ClickHouse
  nodeSelector: {}
  affinity: {}
  # Extra config files mounted to /etc/clickhouse-server/config.d/
  configdFiles:
    09-async-insert.xml: |
      <clickhouse>
        <profiles>
          <default>
            <async_insert>1</async_insert>
            <wait_for_async_insert>0</wait_for_async_insert>
            <async_insert_max_data_size>104857600</async_insert_max_data_size>
            <async_insert_max_query_number>10000</async_insert_max_query_number>
            <async_insert_busy_timeout_ms>1000</async_insert_busy_timeout_ms>
          </default>
        </profiles>
        <max_server_memory_usage_to_ram_ratio>0.8</max_server_memory_usage_to_ram_ratio>
        <max_concurrent_queries>2000</max_concurrent_queries>
      </clickhouse>
clickhouseExtra:
  autoCreateDB:
    - budproxy
    - budeval
    - metrics
postgresql:
  image:
    repository: bitnamilegacy/postgresql
  enabled: true
  primary:
    resources:
      requests:
        memory: 256Mi
      limits:
        memory: 512Mi
    # Optional node scheduling for PostgreSQL primary
    nodeSelector: {}
    affinity: {}
  architecture: standalone
  auth:
    postgresPassword: bud
    username: bud
    password: bud
postgresqlExtra:
  autoCreateDB:
    - keycloak
    - budask
    - budapp
    - budcluster
    - budmetrics
    - budmodel
    - budsim
    - budeval
    - buddoc
    - budprompt
    - mcpgateway
    - budpipeline
    - onyx
keycloak:
  image:
    repository: bitnamilegacy/keycloak
  proxy: edge
  resources:
    limits:
      memory: 2Gi
  enabled: true
  postgresql:
    enabled: false
  externalDatabase:
    host: "{{ $.Release.Name }}-postgresql"
    user: keycloak
    password: keycloak
    database: keycloak
  # Optional node scheduling for Keycloak
  nodeSelector: {}
  affinity: {}
kafka:
  image:
    repository: bitnamilegacy/kafka
  enabled: true
  clusterId: bud
  controller:
    resources:
      requests:
        memory: 1024Mi
      limits:
        memory: 2048Mi
    # Optional node scheduling for Kafka controller
    nodeSelector: {}
    affinity: {}
  broker:
    # Optional node scheduling for Kafka broker
    nodeSelector: {}
    affinity: {}
  tls:
    existingSecret: kafka-jks
    keystorePassword: jksPassword
    truststorePassword: jksPassword
  sasl:
    client:
      users:
        - budproxy
        - dapr
      passwords:
        - budproxy
        - dapr
mongodb:
  image:
    repository: bitnamilegacy/mongodb
  enabled: true
  architecture: standalone
  auth:
    enabled: true
    usernames:
      - novu_user
    passwords:
      - novu_password
    databases:
      - novu_db
  # Optional node scheduling for MongoDB
  nodeSelector: {}
  affinity: {}
novu:
  api:
    env:
      DISABLE_USER_REGISTRATION: false
  externalDatabase:
    host: "{{ $.Release.Name }}-mongodb"
    username: novu_user
    password: novu_password
    database: novu_db
  externalRedis:
    host: "{{ $.Release.Name }}-valkey-primary"
    existingSecret: "{{ $.Release.Name }}-novu-externalredis"
  externalS3:
    existingSecret: "{{ $.Release.Name }}-novu-externals3"
    bucketName: novu-local
minio:
  defaultInitContainers:
    volumePermissions:
      image:
        repository: bitnamilegacy/os-shell
  image:
    repository: bitnamilegacy/minio
  console:
    image:
      digest:
      repository: bitnamilegacy/minio-object-browser
  enabled: true
  resources:
    requests:
      memory: 512Mi
    limits:
      memory: 1024Mi
  provisioning:
    enabled: true
    buckets:
      - name: novu-local
      - name: models-registry
      - name: model-info
      - name: onyx-file-store-bucket
  # Optional node scheduling for MinIO
  nodeSelector: {}
  affinity: {}
# OpenTelemetry Collector for metrics collection
otelCollector:
  enabled: true
  image:
    repository: otel/opentelemetry-collector-contrib
    tag: 0.91.0
  replicas: 1
  logLevel: info
  debug: false
  batchSize: 10000
  batchTimeout: 10s
  memoryLimit: 2048
  memorySpikeLimit: 512
  resources:
    limits:
      memory: 2Gi
      cpu: 1000m
    requests:
      memory: 512Mi
      cpu: 100m
  clickhouse:
    host: clickhouse # Will be templated in the deployment
    port: 9000
    database: metrics
    username: default
    password: ""
    ttl: 720h # 30 days - retention for raw OTel metrics (otel_metrics_*)
  # Optional node scheduling for OTel Collector
  nodeSelector: {}
  affinity: {}
# Minimal Prometheus for HPA custom metrics (gateway processing time)
prometheus:
  enabled: true
  # Disable unnecessary components for HPA-only use case
  alertmanager:
    enabled: false
  kube-state-metrics:
    enabled: false
  prometheus-node-exporter:
    enabled: false
  prometheus-pushgateway:
    enabled: false
  server:
    retention: "2h"
    resources:
      requests:
        cpu: 250m
        memory: 512Mi
      limits:
        cpu: 500m
        memory: 4Gi
    nodeSelector: {}
    affinity: {}
  # Scrape configuration for budgateway metrics
  extraScrapeConfigs: |
    - job_name: 'budgateway'
      scrape_interval: 1s
      kubernetes_sd_configs:
        - role: pod
      relabel_configs:
        - source_labels: [__meta_kubernetes_pod_label_app]
          regex: .*-budgateway
          action: keep
        - source_labels: [__meta_kubernetes_pod_container_port_number]
          regex: "3000"
          action: keep
        - source_labels: [__meta_kubernetes_namespace]
          target_label: namespace
        - source_labels: [__meta_kubernetes_pod_name]
          target_label: pod
# Prometheus Adapter - exposes custom metrics to Kubernetes HPA API
prometheus-adapter:
  enabled: true
  prometheus:
    # URL will be: <release-name>-prometheus-server
    url: "http://{{ $.Release.Name }}-prometheus-server"
    port: 80
  rules:
    custom:
      # Gateway processing overhead p95 metric (summary type with pre-computed quantiles)
      # Selects only the quantile="0.95" series from the summary
      - seriesQuery: 'gateway_processing_seconds{quantile="0.95"}'
        resources:
          overrides:
            pod: {resource: "pod"}
            namespace: {resource: "namespace"}
        name:
          as: "gateway_processing_seconds_p95"
        metricsQuery: 'gateway_processing_seconds{quantile="0.95",<<.LabelMatchers>>}'
# Onyx - AI-powered knowledge assistant with document search
# Uses shared PostgreSQL, Valkey, and MinIO from bud chart
onyx:
  enabled: false
  # Keycloak values for subchart context (used in configMap templates)
  keycloak:
    auth:
      adminUser: "bud"
      adminPassword: "bud"
  # Ingress values for subchart context (used in configMap templates)
  # These should match the parent chart's ingress.hosts values
  ingress:
    hosts:
      root: ""  # Must be set when onyx.enabled=true (e.g., dev.example.com)
  # Disable shared dependencies (use bud's instances)
  postgresql:
    enabled: false
  valkey:
    enabled: false
  minio:
    enabled: false
  # Onyx-managed dependencies
  vespa:
    enabled: true
    name: da-vespa-0
    service:
      name: vespa-service
    replicaCount: 1
    resources:
      requests:
        cpu: 4000m
        memory: 8000Mi
      limits:
        cpu: 8000m
        memory: 32000Mi
  nginx:
    enabled: false  # Disabled - bud uses traefik for ingress
  # Disable Onyx's own ingress (bud's traefik handles routing via ingress.yaml)
  ingress:
    enabled: false
  letsencrypt:
    enabled: false
  # Application configuration
  global:
    version: "latest"
    pullPolicy: "Always"
  # Use bud's shared secrets (created in templates/extra/onyx.yaml)
  auth:
    postgresql:
      enabled: true
      existingSecret: "{{ $.Release.Name }}-onyx-postgresql"
      secretKeys:
        POSTGRES_USER: username
        POSTGRES_PASSWORD: password
    redis:
      enabled: true
      existingSecret: "{{ $.Release.Name }}-onyx-redis"
      secretKeys:
        REDIS_PASSWORD: redis_password
    objectstorage:
      enabled: true
      existingSecret: "{{ $.Release.Name }}-onyx-objectstorage"
      secretKeys:
        S3_AWS_ACCESS_KEY_ID: s3_aws_access_key_id
        S3_AWS_SECRET_ACCESS_KEY: s3_aws_secret_access_key
    oauth:
      enabled: true
      existingSecret: "{{ $.Release.Name }}-onyx-oauth"
      secretKeys:
        KEYCLOAK_ADMIN_PASSWORD: keycloak_admin_password
        # Explicitly nullify subchart defaults - these keys don't exist in our secret
        OAUTH_CLIENT_ID: null
        OAUTH_CLIENT_SECRET: null
        OAUTH_COOKIE_SECRET: null
    smtp:
      enabled: false
  # ConfigMap overrides (template expressions are evaluated via tpl function)
  configMap:
    AUTH_TYPE: "oidc"
    # PostgreSQL database name (created by postgres-db-create Job)
    POSTGRES_DB: "onyx"
    # Redis DB index 11 - unique to Onyx (other services use: 1=Novu, 3=Dapr, 5=global, 9=mcpgateway, 10=budprompt)
    REDIS_DB: "11"
    KEYCLOAK_ADMIN_USERNAME: "{{ .Values.keycloak.auth.adminUser }}"
    KEYCLOAK_REALM: "bud-keycloak"
    WEB_DOMAIN: '{{ printf "https://chat.%s" .Values.ingress.hosts.root }}'
    DOMAIN: "{{ .Values.ingress.hosts.root }}"
    S3_FILE_STORE_BUCKET_NAME: "onyx-file-store-bucket"
    BUD_FOUNDRY_API_BASE: '{{ printf "https://gateway.%s" .Values.ingress.hosts.root }}/v1'
    BUD_FOUNDRY_APP_BASE: '{{ printf "https://app.%s" .Values.ingress.hosts.root }}'
    OPENID_CONFIG_URL: 'http://{{ .Release.Name }}-keycloak/realms/bud-keycloak/.well-known/openid-configuration'
  # Component configurations
  webserver:
    replicaCount: 1
    resources:
      requests:
        cpu: 200m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
  api:
    replicaCount: 1
    resources:
      requests:
        cpu: 1000m
        memory: 1Gi
      limits:
        cpu: 2000m
        memory: 2Gi
  celery_beat:
    replicaCount: 1
  celery_worker_primary:
    replicaCount: 1
  celery_worker_light:
    replicaCount: 1
  celery_worker_heavy:
    replicaCount: 1
  slackbot:
    enabled: false
  # Inference and indexing model servers
  inferenceCapability:
    replicaCount: 1
  indexCapability:
    replicaCount: 1
# best to be installed cluster wide, not as part of this chart
dapr:
  enabled: false
keel:
  enabled: false
