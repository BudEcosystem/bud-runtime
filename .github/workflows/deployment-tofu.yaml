name: "Deployment: OpenTofu Apply Changes"
on:
  push:
    branches:
      - 'master'
    paths:
      - 'infra/terraform/**'
      - 'nix/workflows/tofu_apply/**'
      - 'nix/workflows/secrets.yaml'
      - 'flake.lock'
      - 'flake.nix'
  workflow_dispatch:

jobs:
  nix-workflow:
    name: Run Nix Workflow
    uses: ./.github/workflows/nix-workflow.yaml
    with:
      workflow: tofu_apply
    secrets:
      SOPS_AGE_KEY: "${{ secrets.SOPS_AGE_KEY }}"
